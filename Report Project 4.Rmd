---
title: "Activity of Plant-Origin Compounds on
Fungal Morphogenesis"
author: "Ilana Vinnik"
date: "2024-11-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE,message=FALSE,echo=FALSE}
# Load necessary libraries
library(tidyverse)
library(emmeans)
library(dplyr)
library(kableExtra)
library(ggplot2)
library(tidyr)
library(scales)
library(knitr)
library(forcats)
library(lme4)
library(ggeffects)
library(multcomp)
library(performance)
library(car)
library(broom)
library(RColorBrewer)
library(MASS)
library(gt)

```

```{r,warning=FALSE,message=FALSE,echo=FALSE}
# Load your dataset
file_path <- "~/Desktop/Project 4/LeeDataFungalMorphogenesis.csv"
data <- read.csv(file_path)
data <- data %>%
  dplyr::rename(
    Treatment = "Pos..Control..No.Rx...A..A.SA..B..B.SB..combination.of.A.and.B..combination.of.SA.and.SB",
    Replicate = "Replicate",
    ResponseGT = "Response..GT..germtubes..only",
    ResponseGTPH = "Response..GT...PH",
    ResponseGTBuds = "Response..GT...Buds",
    ResponsePHBuds = "Response..PH...Buds",
    ResponseGTMultiple = "Response...1.GTs.multiple.GTs."
  )
# Simplify the treatment names by re-coding them
data$Treatment <- factor(data$Treatment, 
                         levels = c("No Treatment (positive control)", 
                                    "Whole Aloe arborescens Extract",
                                    "compound 'A' isolated from Aloe arborescens",
                                    "compound 'A-SA' from Sigma Aldrich",
                                    "compound 'B' isolated from Aloe arborescens",
                                    "compound 'B-SA' from Sigma Aldrich",
                                    "combination of A and B",
                                    "combination of A-SA and B-SA"),
                         labels = c("Control", 
                                    "WholeExtract", 
                                    "A", 
                                    "A_SA", 
                                    "B", 
                                    "B_SA", 
                                    "A_B", 
                                    "A_SA_B_SA"))
data$Hyphae_Count<- data$ResponseGT + data$ResponseGTPH + data$ResponseGTBuds + data$ResponseGTMultiple 
```

## Introduction
The rise of antifungal resistance highlights the urgent need for new antifungal agents. This report examines the potential of compounds isolated from Aloe arborescens to modulate the morphogenesis of Candida albicans, a common opportunistic pathogen. Given the limited availability of effective antifungal treatments, exploring natural products like Aloe arborescens may provide promising alternatives.In this study, researchers exposed a single strain of Candida albicans to seven treatments to evaluate their effects on fungal morphology. For each treatment, 200 cells were counted across five replicates, recording the formation of hyphae, buds, and pseudohyphae.

The research hypotheses are as follows:

1.Does each treatment significantly reduce hyphae formation compared to untreated cells?

2.Do treatments with compound 'A' produce greater reductions in hyphae formation than those with compound 'B'?

3.Does the 0.2 micron filtered Aloe arborescens extract lead to the greatest reduction in hyphae formation compared to the other treatments?

## Methods

### Data
The dataset for this study originates from a morphogenesis assay developed to assess the impact of various treatments on the fungal morphology of Candida albicans. This data was collected by Dr. Marcia Lee from the Medical Laboratory Science (MLS) Program at Miami University. The recorded variables include the formation of hyphae, pseudohyphae, and buds, with responses documented as categorical outcomes to capture the effects of different treatments. The dataset comprises 40 observations, with each treatment tested across five replicates. Seven experimental treatments were investigated: Whole Aloe arborescens extract; Compound A, isolated from Aloe arborescens; Compound A-SA, acquired from Sigma-Aldrich Company; Compound B, also isolated from Aloe arborescens; Compound B-SA, sourced from Sigma-Aldrich; a combination of Compounds A and B; and a combination of Compounds A-SA and B-SA.

Each cell was evaluated microscopically to categorize its response, classified into one of eight possible outcomes: no hypha (GT), no pseudohypha (PH), and no buds (B); GT only; PH only; B only; GT combined with PH; GT combined with B; PH combined with B; or the presence of more than one GT.

## Statistical Analysis

To assess the effects of various treatments on the presence of hyphae in Candida albicans, a Quasi-Poisson Generalized Linear Model (GLM) was employed. This model is suitable for count data with overdispersion, allowing us to examine the differential impact of each treatment on hyphae formation. The hyphae count was used as the response variable, calculated as the sum of cells with hyphae in categories GT only, GT with PH, GT with B, and Greater than one GT. Given that each sample was limited to a cell count of 200, to account for that an offset of \( \log(200) \) was included in the model.

The model is represented by:

\[
\log(\text{Hyphae Count}) = -0.16 - 3.3 \times \text{Whole Extract} - 1.80 \times \text{Treatment A} - 1.96 \times \text{Treatment A\_SA} - 1.59 \times \text{Treatment B} - 1.23 \times \text{Treatment B\_SA} - 2.07 \times \text{Treatment A\_B} - 2.17 \times \text{Treatment A\_SA\_B\_SA} + \log(200)
\]
 

### Contrasts

- **Research Hypothesis (H₁)**: Exposure to each of the seven treatments will result in statistically significant reductions in hyphae formation compared to non-exposed cells (control).

  Equation for Comparison:  
  \[
  H_0: \mu_{\text{Treatment}_i} = \mu_{\text{Control}} \quad \text{vs.} \quad H_1: \mu_{\text{Treatment}_i} \neq \mu_{\text{Control}}
  \]
  where \(\mu_{\text{Treatment}_i}\) is the mean hyphae count for each treatment, and \(\mu_{\text{Control}}\) is the mean hyphae count for the control group.

- **Research Hypothesis (H₂)**: Adding SA to compounds A and B, or combining A and B with SA, will result in greater reductions in hyphae formation.

  Equations for Specific Comparisons:  
  1. **A vs. A_SA:**  
     \[
     H_0: \mu_{\text{A}} = \mu_{\text{A\_SA}} \quad \text{vs.} \quad H_1: \mu_{\text{A}} \neq \mu_{\text{A\_SA}}
     \]
  2. **B vs. B_SA:**  
     \[
     H_0: \mu_{\text{B}} = \mu_{\text{B\_SA}} \quad \text{vs.} \quad H_1: \mu_{\text{B}} \neq \mu_{\text{B\_SA}}
     \]
  3. **A_B vs. A_SA_B_SA:**  
     \[
     H_0: \mu_{\text{A\_B}} = \mu_{\text{A\_SA\_B\_SA}} \quad \text{vs.} \quad H_1: \mu_{\text{A\_B}} \neq \mu_{\text{A\_SA\_B\_SA}}
     \]

- **Research Hypothesis (H₃)**: The Whole Extract treatment results in a greater reduction in hyphae formation compared to the other treatments.

  Equation for Comparison:  
  \[
  H_0: \mu_{\text{WholeExtract}} = \mu_{\text{Treatment}_i} \quad \text{vs.} \quad H_1: \mu_{\text{WholeExtract}} \neq \mu_{\text{Treatment}_i}
  \]
  where \(\mu_{\text{WholeExtract}}\) is the mean hyphae count for the WholeExtract treatment, and \(\mu_{\text{Treatment}_i}\) represents the mean hyphae counts for each of the other treatments.




#### Significance Level
A significance level of α=0.05 was used for all hypothesis testing. This threshold guided the interpretation of results, determining whether the observed effects of treatments were statistically significant. For p-value adjustments, the Dunnett's test (dunnettx) method was used for Hypotheses 1 and 3, while the Bonferroni method was applied for Hypothesis 2.

### Software
The statistical analyses and data visualizations for this study were conducted using R  and various R packages. The following packages were utilized:


- Wickham H, Averick M, Bryan J, et al. (2019). "Welcome to the tidyverse." *Journal of Open Source Software*, 4(43), 1686. <https://doi.org/10.21105/joss.01686>.

- Lenth, R. V. (2023). *emmeans: Estimated Marginal Means, aka Least-Squares Means*. R package version 1.8.5. <https://CRAN.R-project.org/package=emmeans>.

- Wickham, H., François, R., Henry, L., & Müller, K. (2023). *dplyr: A Grammar of Data Manipulation*. R package version 1.1.1. <https://CRAN.R-project.org/package=dplyr>.

- Zhu, H. (2023). *kableExtra: Construct Complex Table with 'kable' and Pipe Syntax*. R package version 1.3.4. <https://CRAN.R-project.org/package=kableExtra>.

- Wickham, H. (2016). *ggplot2: Elegant Graphics for Data Analysis*. Springer-Verlag New York. ISBN 978-3-319-24277-4, <https://ggplot2.tidyverse.org>.

- Wickham, H. (2023). *tidyr: Tidy Messy Data*. R package version 1.2.2. <https://CRAN.R-project.org/package=tidyr>.

- Wickham, H., & Seidel, D. (2022). *scales: Scale Functions for Visualization*. R package version 1.2.1. <https://CRAN.R-project.org/package=scales>.

- Xie, Y. (2015). *Dynamic Documents with R and knitr*. 2nd edition. Chapman & Hall/CRC. ISBN 978-1498716963. <https://yihui.org/knitr/>.

- Wickham, H. (2023). *forcats: Tools for Working with Categorical Variables (Factors)*. R package version 1.0.0. <https://CRAN.R-project.org/package=forcats>.

- Bates, D., Mächler, M., Bolker, B., & Walker, S. (2015). "Fitting Linear Mixed-Effects Models Using lme4." *Journal of Statistical Software*, 67(1), 1-48. <https://doi.org/10.18637/jss.v067.i01>.

- Lüdecke, D. (2018). "ggeffects: Tidy Data Frames of Marginal Effects for 'ggplot' from Model Outputs." *Journal of Open Source Software*, 3(26), 772. <https://doi.org/10.21105/joss.00772>.

- Hothorn, T., Bretz, F., & Westfall, P. (2008). "Simultaneous Inference in General Parametric Models." *Biometrical Journal*, 50(3), 346–363. <https://doi.org/10.1002/bimj.200810425>.

- Lüdecke, D., et al. (2021). *performance: Assessment of Regression Models Performance*. R package version 0.9.0. <https://CRAN.R-project.org/package=performance>.

- Fox, J., & Weisberg, S. (2019). *An {R} Companion to Applied Regression*. 3rd ed. Sage. <https://socialsciences.mcmaster.ca/jfox/Books/Companion/>.

- Robinson, D., Hayes, A., & Couch, S. (2023). *broom: Convert Statistical Objects into Tidy Tibbles*. R package version 1.0.5. <https://CRAN.R-project.org/package=broom>.

- Neuwirth, E. (2014). *RColorBrewer: ColorBrewer Palettes*. R package version 1.1-2. <https://CRAN.R-project.org/package=RColorBrewer>.

- Venables, W. N., & Ripley, B. D. (2002). *Modern Applied Statistics with S*. Fourth Edition. Springer, New York. ISBN 0-387-95457-0.

- Iannone, R., Cheng, J., & Schloerke, B. (2022). *gt: Easily Create Presentation-Ready Display Tables*. R package version 0.5.0. <https://CRAN.R-project.org/package=gt>.



## Results

### Exploratory Data Analysis

Figure 1 and Table 1 collectively demonstrate the effectiveness of different treatments in reducing hyphae formation in Candida albicans. Figure 1 visually represents the mean proportion of hyphae formation across treatments. The control group displays a high baseline proportion, indicating that hyphae formation is prevalent in the absence of treatment. In contrast, the Whole Aloe arborescens extract treatment nearly eliminates hyphae formation, while other treatments, such as Compounds A and B and their combinations, result in moderate reductions. The error bars in Figure 1 indicate some variability in the hyphae response within each treatment group.

Table 1 provides complementary descriptive statistics, detailing the mean and median hyphae counts for each treatment. The high mean hyphae count in the control group (170) emphasizes the relative effectiveness of the treatments, with Whole Aloe arborescens extract showing the most substantial reduction in hyphae formation. Collectively, these results underscore the differential impacts of the treatments, with Whole Aloe arborescens extract proving particularly effective in inhibiting hyphae development in Candida albicans.

```{r,warning=FALSE,message=FALSE,echo=FALSE}


# Create the Statistical Summary Table
summary_table <- data %>%
  group_by(Treatment) %>%
  summarise(
    Count = n(),
    Mean_Hypha_Count = mean(Hyphae_Count, na.rm = TRUE),
    Median_Hypha_Count = median(Hyphae_Count, na.rm = TRUE),
    SD_Hypha_Count = sd(Hyphae_Count, na.rm = TRUE)
  )

# Display the summary table using knitr::kable for formatting
knitr::kable(
  summary_table,
  caption = "Statistical Summary Table for Hyphae Counts by Treatment",
  col.names = c("Treatment", "Count", "Mean ", "Median ", "SD"),
  digits = 2,
  format = "markdown"  # Use "html" for HTML output, or "latex" for PDF output in R Markdown
)

```

Table 1: Descriptive statistics for hyphae counts by treatment type.

```{r,warning=FALSE,message=FALSE,echo=FALSE}
# Convert Mean Hypha Count to Proportion
summary_table <- summary_table %>%
  mutate(Mean_Hypha_Proportion = Mean_Hypha_Count / 200,
         SD_Hypha_Proportion = SD_Hypha_Count / 200)

# Bar Plot of Hypha Count Proportion with Color-Blind-Friendly Palette
bar_plot <- ggplot(summary_table, aes(x = Treatment, y = Mean_Hypha_Proportion, fill = Treatment)) +
  geom_bar(stat = "identity") +  # Use different colors for each treatment
  geom_errorbar(aes(ymin = Mean_Hypha_Proportion - SD_Hypha_Proportion,
                    ymax = Mean_Hypha_Proportion + SD_Hypha_Proportion), width = 0.2) +
  labs(title = "Effect of Treatments on Mean Hypha Formation Proportion",
       x = "Treatment Type",
       y = "Proportion of Hyphae Formed (per 200 cells)") +
  scale_fill_brewer(palette = "Set2") +               # Use a color-blind-friendly palette
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),           # Center the title
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text = element_text(size = 10),              # Adjust axis label size
    legend.position = "none",                         # Remove the legend
    panel.grid = element_blank()                     # Remove the grid backgrou  # Add axis border
  )

# Print the bar plot
print(bar_plot)



```

Figure 1: Mean hyphae formation proportion by treatment type with standard deviations.

### Model

The model results suggest that by exponentiating the coefficients for each treatment, we obtain the multiplicative factor by which the mean hyphae count changes compared to the control (baseline) group.

For example, consider the coefficient for the Whole Aloe arborescens Extract treatment, which is -3.344. By exponentiating this coefficient, we calculate the factor by which the mean hyphae count changes when this treatment is applied:

\[
e^{-3.344} \approx 0.035
\]

This result implies that, with the Whole Aloe arborescens Extract treatment, the mean hyphae count is reduced to just 3.5% of the control group’s count. Put another way, this treatment decreases the mean hyphae count by 96.5% (since \( 1 - 0.035 = 0.965 \)) compared to the control.
Similarly, for other treatments, exponentiating the coefficients allows us to interpret each as a percentage change relative to the control (See Table 2.) Since this is a log-linked model, these interpretations focus on multiplicative effects—each treatment reduces the hyphae count by a specific percentage of the control group rather than by an absolute number (Weiss, 2016).


```{r,warning=FALSE,message=FALSE,echo=FALSE}
data$offset_log200 <- log(200)

model <- glm(Hyphae_Count ~ Treatment + offset(offset_log200), 
             family = quasipoisson(link = "log"), data = data)
```

```{r,echo=FALSE}

data$offset_log200 <- log(200)

# Fit the quasi-Poisson model
model <- glm(Hyphae_Count ~ Treatment + offset(offset_log200), 
             family = quasipoisson(link = "log"), data = data)

# Extract and calculate additional summary statistics
summary_table <- tidy(model, conf.int = TRUE) %>%
  mutate(
    Estimate=estimate,
    `Rate Ratio` = exp(estimate),                       # Exponentiated effect size
    `Lower 95% CI` = exp(conf.low),                   # Exponentiate lower CI
    `Upper 95% CI` = exp(conf.high),                  # Exponentiate upper CI
    `Percent of Control` = `Rate Ratio` * 100,            # Percentage of the control
    `Reduction Percent` = (1 - `Rate Ratio`) * 100,       # Reduction percentage relative to control
    Significance = case_when(                         # Significance codes
      p.value < 0.001 ~ "***",
      p.value < 0.01 ~ "**",
      p.value < 0.05 ~ "*",
      p.value < 0.1 ~ ".",
      TRUE ~ ""
    )
  ) %>%
  dplyr::select(term, Estimate, `Rate Ratio`, `Percent of Control`, `Reduction Percent`, `Lower 95% CI`, `Upper 95% CI`, std.error, statistic, p.value, Significance) %>%
  dplyr::rename(
    "Treatment" = term,
    "Std. Error" = std.error,
    "t value" = statistic,
    "P-value" = p.value
  )

# Display the summary table in a nice format
kable(summary_table, caption = "Effect Sizes with Percent of Control, Reduction Percent, and Confidence Intervals for Hyphae Formation by Treatment")


```


Table 2: Summary of quasi-Poisson model results showing the estimated effects of treatments on hyphae count, with significant reductions in hyphae formation observed for all treatments compared to the control.


```{r,warning=FALSE,message=FALSE,echo=FALSE}
# Calculate the dispersion statistic
dispersion_stat <- summary(model)$deviance / summary(model)$df.residual

# Extract residuals
model_data <- data.frame(
  Fitted = fitted(model),
  Pearson_Residuals = residuals(model, type = "pearson"),
  Deviance_Residuals = residuals(model, type = "deviance")
)

# Plot Pearson residuals
g<-ggplot(model_data, aes(x = Fitted, y = Pearson_Residuals)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "Pearson Residuals vs Fitted Values",
       x = "Fitted Values",
       y = "Pearson Residuals") +
  theme_minimal()

# Plot Deviance residuals
p<-ggplot(model_data, aes(x = Fitted, y = Deviance_Residuals)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "Deviance Residuals vs Fitted Values",
       x = "Fitted Values",
       y = "Deviance Residuals") +
  theme_minimal()
# Goodness-of-fit test
gof.pvalue = 1 - pchisq(model$deviance, model$df.residual)


```


The dispersion statistic of 1.36 indicates mild overdispersion in the data, suggesting that while the quasi-Poisson model generally fits well, there is slightly more variability than expected. Although a negative binomial model could address this overdispersion, its application is limited by the relatively small sample size. Small sample sizes can lead to unreliable estimates of the dispersion parameter in negative binomial models, potentially resulting in unstable and biased estimates. Therefore, the quasi-Poisson model remains a practical choice, adequately addressing the mild overdispersion without introducing the complexities associated with negative binomial models in small-sample contexts (See Yu, Huber, & Vitek, 2013).

### Contrasts

#### Hypothesis 1:

In Table 3, we assess the impact of each treatment on hyphae formation compared to the control group, which represents non-exposed cells. The Estimate column reflects log-transformed effect sizes; exponentiating these values reveals the percentage reduction in hyphae formation relative to the control. Each treatment achieves a highly significant reduction in hyphae formation, with all p-values indicating strong statistical evidence for these effects and substantial Z-ratios.

For instance, the Whole Aloe arborescens extract treatment has an estimate of -3.34, signifying a reduction in hyphae formation to about 3.5% of the control level. This translates to a 96.5% decrease in hyphae formation compared to control cells. Similarly, treatments such as Compound A, Compound A-SA, and Compound B show substantial reductions, each bringing hyphae formation down to between 12% and 18% of the control levels.

In conclusion, these findings confirm that each treatment significantly reduces hyphae formation compared to the control, addressing the research question by highlighting the efficacy of each compound in suppressing fungal growth.


```{r,warning=FALSE,message=FALSE,echo=FALSE}
# Obtain estimated marginal means and set up contrasts for each treatment vs control
emm <- emmeans(model, ~ Treatment)
contrast1 <- contrast(emm, method = "trt.vs.ctrl", ref = "Control")

# Get summary results for Hypothesis 1
contrast1_summary <- summary(contrast1, infer = TRUE)

# Convert summary to a data frame for formatting with gt
contrast1_df <- as.data.frame(contrast1_summary)

# Create a formatted table with gt (adjust columns based on actual names if needed)
gt_table <- contrast1_df %>%
  gt() %>%
  cols_label(
    contrast = "Comparison",
    estimate = "Estimate",
    SE = "Std. Error",
    asymp.LCL = "95% CI Lower",
    asymp.UCL = "95% CI Upper",
    z.ratio = "Z-ratio",
    p.value = "P-value"
  ) %>%
  fmt_number(
    columns = vars(estimate, SE, asymp.LCL, asymp.UCL, z.ratio),
    decimals = 2
  ) %>%
  fmt_number(
    columns = vars(p.value),
    decimals = 4,
    use_seps = FALSE
  ) %>%
  tab_header(
    title = "Hypothesis 1: Each Treatment vs. Control"
  )

# Display the table
gt_table

```

Table 3: Effect of Each Treatment on Hyphae Formation Compared to Control.


#### Hypothesis 2:

Table 4 presents the results for Hypothesis 2, which examines specific pairwise comparisons of treatments with the Bonferroni correction applied. This adjustment mitigates the risk of Type I errors from multiple tests.

A vs A_SA: The estimated difference of 0.16, with a Z ratio of 1.12 and with an adjusted p-value of 0.7910, suggests no statistically significant effect. Thus, adding SA to Compound A does not significantly enhance its ability to reduce hyphae formation.

B vs B_SA: The estimated difference of -0.36, with a Z ratio -3.12 accompanied by an adjusted p-value of 0.0054, indicates a statistically significant effect. This finding suggests that adding SA to Compound B further reduces hyphae formation by approximately 36%, demonstrating a notable enhancement in antifungal activity with the addition of SA.

A_B vs A_SA_B_SA: The estimated difference of 0.10, with a Z ratio of 0.60 and  an adjusted p-value of 1.0000, reveals no significant effect. This result implies that adding SA to the combination of Compounds A and B does not yield any additional reduction in hyphae formation.

In summary, after adjusting for multiple comparisons, only the addition of SA to Compound B (B vs B_SA) remains statistically significant, indicating an enhanced antifungal effect when SA is combined with Compound B.


```{r,warning=FALSE,message=FALSE,echo=FALSE}


# Fit the quasi-Poisson model with an offset
data$offset_log200 <- log(200)
model <- glm(Hyphae_Count ~ Treatment + offset(offset_log200), 
             family = quasipoisson(link = "log"), data = data)

# Obtain estimated marginal means for each treatment
emm <- emmeans(model, ~ Treatment)

# Define custom contrasts for Hypothesis 2 as a list
contrast2 <- contrast(emm, method = list(
  "A vs A_SA" = c("Control" = 0, "WholeExtract" = 0, "A" = 1, "A_SA" = -1, "B" = 0, "B_SA" = 0, "A_B" = 0, "A_SA_B_SA" = 0),
  "B vs B_SA" = c("Control" = 0, "WholeExtract" = 0, "A" = 0, "A_SA" = 0, "B" = 1, "B_SA" = -1, "A_B" = 0, "A_SA_B_SA" = 0),
  "A_B vs A_SA_B_SA" = c("Control" = 0, "WholeExtract" = 0, "A" = 0, "A_SA" = 0, "B" = 0, "B_SA" = 0, "A_B" = 1, "A_SA_B_SA" = -1)
))

# Get summary results for Hypothesis 2 with Bonferroni adjustment
contrast2_summary <- summary(contrast2, infer = TRUE, adjust = "bonferroni")

# Convert summary to a data frame for formatting with gt
contrast2_df <- as.data.frame(contrast2_summary)

# Create a nicely formatted table with gt
gt_table <- contrast2_df %>%
  gt() %>%
  cols_label(
    contrast = "Comparison",
    estimate = "Estimate",
    SE = "Std. Error",
    asymp.LCL = "95% CI Lower",
    asymp.UCL = "95% CI Upper",
    z.ratio = "Z-ratio",
    p.value = "P-value (Bonferroni)"
  ) %>%
  fmt_number(
    columns = vars(estimate, SE, asymp.LCL, asymp.UCL, z.ratio),
    decimals = 2
  ) %>%
  fmt_number(
    columns = vars(p.value),
    decimals = 4,
    use_seps = FALSE
  ) %>%
  tab_header(
    title = "Hypothesis 2: Specific Group Comparisons with Bonferroni Adjustment"
  )

# Display the table
gt_table

```

Table 4: Specific Group Comparisons for Hypothesis 2 – Effect of Adding SA to Compounds A and B, and Combined Treatment Effects.

#### Hypothesis 3:

Table 5 provides the results for Hypothesis 3, which examines the relative effectiveness of each treatment in reducing hyphae formation, using WholeExtract as the baseline. The Estimate values reflect the log-transformed differences in hyphae formation between each treatment and WholeExtract, with positive estimates indicating a higher level of hyphae formation in the treatment group compared to WholeExtract.

Control vs. WholeExtract: The estimate of 3.34, with a highly significant p-value, indicates that the control group exhibits significantly higher hyphae formation than the WholeExtract treatment. This finding emphasizes the potent effect of WholeExtract in suppressing hyphae formation.

Other Treatments vs. WholeExtract: Each of the experimental treatments (A, A_SA, B, B_SA, A_B, A_SA_B_SA) also has positive estimates compared to WholeExtract, with all showing significant p-values. This suggests that, while these treatments effectively reduce hyphae formation, WholeExtract consistently shows the strongest suppressive effect among all treatments.

In summary, the results support Hypothesis 3, confirming that WholeExtract produces the greatest reduction in hyphae formation compared to each of the other treatments. The positive estimates and significant p-values across all comparisons highlight WholeExtract’s superior efficacy in inhibiting fungal growth.

```{r,warning=FALSE,message=FALSE,echo=FALSE}
 # Load necessary libraries
library(emmeans)
library(dplyr)
library(gt)

# Fit the quasi-Poisson model with an offset
data$offset_log200 <- log(200)
model <- glm(Hyphae_Count ~ Treatment + offset(offset_log200), 
             family = quasipoisson(link = "log"), data = data)

# Obtain estimated marginal means for each treatment
emm <- emmeans(model, ~ Treatment)

# Set up contrasts comparing each treatment to WholeExtract as the base
contrast3 <- contrast(emm, method = "trt.vs.ctrl", ref = "WholeExtract")

# Get summary results for Hypothesis 3
contrast3_summary <- summary(contrast3, infer = TRUE)

# Convert summary to a data frame for formatting with gt
contrast3_df <- as.data.frame(contrast3_summary)

# Create a nicely formatted table with gt
gt_table <- contrast3_df %>%
  gt() %>%
  cols_label(
    contrast = "Comparison",
    estimate = "Estimate",
    SE = "Std. Error",
    asymp.LCL = "95% CI Lower",
    asymp.UCL = "95% CI Upper",
    z.ratio = "Z-ratio",
    p.value = "P-value"
  ) %>%
  fmt_number(
    columns = vars(estimate, SE, asymp.LCL, asymp.UCL, z.ratio),
    decimals = 2
  ) %>%
  fmt_number(
    columns = vars(p.value),
    decimals = 4,
    use_seps = FALSE
  ) %>%
  tab_header(
    title = "Hypothesis 3: Each Treatment vs. WholeExtract"
  )

# Display the table
gt_table


```

Table 5: Comparison of Each Treatment’s Effect on Hyphae Formation Relative to WholeExtract.

## Conclusion

The analysis demonstrated that each experimental treatment effectively reduced hyphae formation in Candida albicans, though the extent of reduction varied by treatment. The quasi-Poisson model allowed us to examine these relative effects in detail, with Whole Aloe Extract emerging as the most potent inhibitor of hyphae formation. The results indicate that the use of commercially purchased SA compounds, particularly when combined with Compound B (extracted by a biochemist), may enhance antifungal efficacy. However, this enhancement was not consistent across all combinations, suggesting that the benefits of SA compounds may depend on specific interactions with the naturally extracted compounds.

Given the small sample size, the analysis may be limited by reduced statistical power, which influenced the selection of a quasi-Poisson model over other potential methods. Small sample sizes can increase the variability of estimates and restrict the generalizability of results. Additionally, these findings are based on a controlled experimental environment, which may not fully capture the complex interactions that could occur in broader biological contexts.

In conclusion, these findings underscore the high effectiveness of Whole Aloe Extract in suppressing hyphae formation and provide valuable insights into the potential of compound combinations for targeted antifungal applications. Future research with larger sample sizes and varied experimental conditions would help to clarify the observed effects and enhance the robustness of these findings.

## Refrences

Danni Yu, Wolfgang Huber, Olga Vitek, Shrinkage estimation of dispersion in Negative Binomial models for RNA-seq experiments with small sample size, Bioinformatics, Volume 29, Issue 10, May 2013, Pages 1275–1282, https://doi.org/10.1093/bioinformatics/btt143

Lee, M. (n.d.). Activity of Plant-Origin Compounds on Fungal Morphogenesis. Medical Laboratory Science (MLS) Program, Miami University.

Weiss, R. E. (2016). Beyond multiple linear regression: Applied generalized linear models and multilevel models in R. CRC Press.

## Appendix
````{r, echo=TRUE, comment=NA}

# Load necessary libraries
library(tidyverse)
library(emmeans)
library(dplyr)
library(kableExtra)
library(ggplot2)
library(tidyr)
library(scales)
library(knitr)
library(forcats)
library(lme4)
library(ggeffects)
library(multcomp)
library(performance)
library(car)
library(broom)
library(RColorBrewer)
library(MASS)
library(gt)


# Load your dataset
file_path <- "~/Desktop/Project 4/LeeDataFungalMorphogenesis.csv"
data <- read.csv(file_path)
data <- data %>%
  dplyr::rename(
    Treatment = "Pos..Control..No.Rx...A..A.SA..B..B.SB..combination.of.A.and.B..combination.of.SA.and.SB",
    Replicate = "Replicate",
    ResponseGT = "Response..GT..germtubes..only",
    ResponseGTPH = "Response..GT...PH",
    ResponseGTBuds = "Response..GT...Buds",
    ResponsePHBuds = "Response..PH...Buds",
    ResponseGTMultiple = "Response...1.GTs.multiple.GTs."
  )
# Simplify the treatment names by re-coding them
data$Treatment <- factor(data$Treatment, 
                         levels = c("No Treatment (positive control)", 
                                    "Whole Aloe arborescens Extract",
                                    "compound 'A' isolated from Aloe arborescens",
                                    "compound 'A-SA' from Sigma Aldrich",
                                    "compound 'B' isolated from Aloe arborescens",
                                    "compound 'B-SA' from Sigma Aldrich",
                                    "combination of A and B",
                                    "combination of A-SA and B-SA"),
                         labels = c("Control", 
                                    "WholeExtract", 
                                    "A", 
                                    "A_SA", 
                                    "B", 
                                    "B_SA", 
                                    "A_B", 
                                    "A_SA_B_SA"))
data$Hyphae_Count<- data$ResponseGT + data$ResponseGTPH + data$ResponseGTBuds + data$ResponseGTMultiple 


# Create the Statistical Summary Table
summary_table <- data %>%
  group_by(Treatment) %>%
  summarise(
    Count = n(),
    Mean_Hypha_Count = mean(Hyphae_Count, na.rm = TRUE),
    Median_Hypha_Count = median(Hyphae_Count, na.rm = TRUE),
    SD_Hypha_Count = sd(Hyphae_Count, na.rm = TRUE)
  )


# Convert Mean Hypha Count to Proportion
summary_table <- summary_table %>%
  mutate(Mean_Hypha_Proportion = Mean_Hypha_Count / 200,
         SD_Hypha_Proportion = SD_Hypha_Count / 200)

# Bar Plot of Hypha Count Proportion with Color-Blind-Friendly Palette
bar_plot <- ggplot(summary_table, aes(x = Treatment, y = Mean_Hypha_Proportion, fill = Treatment)) +
  geom_bar(stat = "identity") +  # Use different colors for each treatment
  geom_errorbar(aes(ymin = Mean_Hypha_Proportion - SD_Hypha_Proportion,
                    ymax = Mean_Hypha_Proportion + SD_Hypha_Proportion), width = 0.2) +
  labs(title = "Effect of Treatments on Mean Hypha Formation Proportion",
       x = "Treatment Type",
       y = "Proportion of Hyphae Formed (per 200 cells)") +
  scale_fill_brewer(palette = "Set2") +               # Use a color-blind-friendly palette
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),           # Center the title
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
    axis.text = element_text(size = 10),              # Adjust axis label size
    legend.position = "none",                         # Remove the legend
    panel.grid = element_blank()                     # Remove the grid backgrou  # Add axis border
  )


data$offset_log200 <- log(200)


# Fit the quasi-Poisson model
data$offset_log200 <- log(200)
model <- glm(Hyphae_Count ~ Treatment + offset(offset_log200), 
             family = quasipoisson(link = "log"), data = data)




# Fit the quasi-Poisson model
data$offset_log200 <- log(200)
model <- glm(Hyphae_Count ~ Treatment + offset(offset_log200), 
             family = quasipoisson(link = "log"), data = data)

# Extract important summary statistics with confidence intervals
summary_table <- tidy(model, conf.int = TRUE) %>%
  mutate(
    Estimate = exp(estimate),                           # Exponentiated effect size
    `Lower 95% CI` = exp(conf.low),                     # Exponentiate lower CI
    `Upper 95% CI` = exp(conf.high),                    # Exponentiate upper CI
    Significance = case_when(                           # Significance codes
      p.value < 0.001 ~ "***",
      p.value < 0.01 ~ "**",
      p.value < 0.05 ~ "*",
      p.value < 0.1 ~ ".",
      TRUE ~ ""
    )
  ) %>%
  dplyr::select(term, Estimate, `Lower 95% CI`, `Upper 95% CI`, std.error, statistic, p.value, Significance) %>%
  dplyr::rename(
    "Treatment" = term,
    "Std. Error" = std.error,
    "t value" = statistic,
    "P-value" = p.value
  )



# Calculate the dispersion statistic
dispersion_stat <- summary(model)$deviance / summary(model)$df.residual


# Extract residuals
model_data <- data.frame(
  Fitted = fitted(model),
  Pearson_Residuals = residuals(model, type = "pearson"),
  Deviance_Residuals = residuals(model, type = "deviance")
)

# Plot Pearson residuals
g<-ggplot(model_data, aes(x = Fitted, y = Pearson_Residuals)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "Pearson Residuals vs Fitted Values",
       x = "Fitted Values",
       y = "Pearson Residuals") +
  theme_minimal()

# Plot Deviance residuals
p<-ggplot(model_data, aes(x = Fitted, y = Deviance_Residuals)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "Deviance Residuals vs Fitted Values",
       x = "Fitted Values",
       y = "Deviance Residuals") +
  theme_minimal()
# Goodness-of-fit test
gof.pvalue = 1 - pchisq(model$deviance, model$df.residual)



# Obtain estimated marginal means and set up contrasts for each treatment vs control
emm <- emmeans(model, ~ Treatment)
contrast1 <- contrast(emm, method = "trt.vs.ctrl", ref = "Control")

# Get summary results for Hypothesis 1
contrast1_summary <- summary(contrast1, infer = TRUE)

# Convert summary to a data frame for formatting with gt
contrast1_df <- as.data.frame(contrast1_summary)

# Create a formatted table with gt (adjust columns based on actual names if needed)
gt_table <- contrast1_df %>%
  gt() %>%
  cols_label(
    contrast = "Comparison",
    estimate = "Estimate",
    SE = "Std. Error",
    asymp.LCL = "95% CI Lower",
    asymp.UCL = "95% CI Upper",
    z.ratio = "Z-ratio",
    p.value = "P-value"
  ) %>%
  fmt_number(
    columns = vars(estimate, SE, asymp.LCL, asymp.UCL, z.ratio),
    decimals = 2
  ) %>%
  fmt_number(
    columns = vars(p.value),
    decimals = 4,
    use_seps = FALSE
  ) %>%
  tab_header(
    title = "Hypothesis 1: Each Treatment vs. Control"
  )



# Fit the quasi-Poisson model with an offset
data$offset_log200 <- log(200)
model <- glm(Hyphae_Count ~ Treatment + offset(offset_log200), 
             family = quasipoisson(link = "log"), data = data)

# Obtain estimated marginal means for each treatment
emm <- emmeans(model, ~ Treatment)

# Define custom contrasts for Hypothesis 2 as a list
contrast2 <- contrast(emm, method = list(
  "A vs A_SA" = c("Control" = 0, "WholeExtract" = 0, "A" = 1, "A_SA" = -1, "B" = 0, "B_SA" = 0, "A_B" = 0, "A_SA_B_SA" = 0),
  "B vs B_SA" = c("Control" = 0, "WholeExtract" = 0, "A" = 0, "A_SA" = 0, "B" = 1, "B_SA" = -1, "A_B" = 0, "A_SA_B_SA" = 0),
  "A_B vs A_SA_B_SA" = c("Control" = 0, "WholeExtract" = 0, "A" = 0, "A_SA" = 0, "B" = 0, "B_SA" = 0, "A_B" = 1, "A_SA_B_SA" = -1)
))

# Get summary results for Hypothesis 2 with Bonferroni adjustment
contrast2_summary <- summary(contrast2, infer = TRUE, adjust = "bonferroni")

# Convert summary to a data frame for formatting with gt
contrast2_df <- as.data.frame(contrast2_summary)

# Create a nicely formatted table with gt
gt_table <- contrast2_df %>%
  gt() %>%
  cols_label(
    contrast = "Comparison",
    estimate = "Estimate",
    SE = "Std. Error",
    asymp.LCL = "95% CI Lower",
    asymp.UCL = "95% CI Upper",
    z.ratio = "Z-ratio",
    p.value = "P-value (Bonferroni)"
  ) %>%
  fmt_number(
    columns = vars(estimate, SE, asymp.LCL, asymp.UCL, z.ratio),
    decimals = 2
  ) %>%
  fmt_number(
    columns = vars(p.value),
    decimals = 4,
    use_seps = FALSE
  ) %>%
  tab_header(
    title = "Hypothesis 2: Specific Group Comparisons with Bonferroni Adjustment"
  )



# Fit the quasi-Poisson model with an offset
data$offset_log200 <- log(200)
model <- glm(Hyphae_Count ~ Treatment + offset(offset_log200), 
             family = quasipoisson(link = "log"), data = data)

# Obtain estimated marginal means for each treatment
emm <- emmeans(model, ~ Treatment)

# Set up contrasts comparing each treatment to WholeExtract as the base
contrast3 <- contrast(emm, method = "trt.vs.ctrl", ref = "WholeExtract")

# Get summary results for Hypothesis 3
contrast3_summary <- summary(contrast3, infer = TRUE)

# Convert summary to a data frame for formatting with gt
contrast3_df <- as.data.frame(contrast3_summary)

# Create a nicely formatted table with gt
gt_table <- contrast3_df %>%
  gt() %>%
  cols_label(
    contrast = "Comparison",
    estimate = "Estimate",
    SE = "Std. Error",
    asymp.LCL = "95% CI Lower",
    asymp.UCL = "95% CI Upper",
    z.ratio = "Z-ratio",
    p.value = "P-value"
  ) %>%
  fmt_number(
    columns = vars(estimate, SE, asymp.LCL, asymp.UCL, z.ratio),
    decimals = 2
  ) %>%
  fmt_number(
    columns = vars(p.value),
    decimals = 4,
    use_seps = FALSE
  ) %>%
  tab_header(
    title = "Hypothesis 3: Each Treatment vs. WholeExtract"
  )


````
